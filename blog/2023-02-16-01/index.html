<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta name="description"><title>mattn | Audio System</title><style>html{visibility:hidden;opacity:0}</style><link href="https://www.mattnewcomer.org/style.css" rel="stylesheet"></head><body><header class="space"><a href="https://www.mattnewcomer.org">← Home</a></header><main><h1>Audio System</h1><p class="secondary">16 February 2023 (updated 19 February 2023)</p><div class="space"></div><p>Recently I became a bit of a stereo-head.</p><p>When I got my first <a href="https://www.mattnewcomer.org/blog/2023-01-17-01/">real pair of headphones</a>, I was blown away by what they could do. I mean, I was listening to them out of my <a href="https://www.mattnewcomer.org/blog/2022-12-13-01/">nugget of a cell phone</a> where I could hear an audible hum if I lowered the volume too much. Instead of taking the next reasonable step of getting a little portable DAC and getting on with my life, I decided to build a little home audio setup.</p><p>I’d like to show you what I ended up building.</p><h2 id="high-level-goals">High Level Goals</h2><p>I have a somewhat odd set of constraints that shaped how I built my system:</p><ul><li>I have music files stored on a home server</li><li>I have video being streamed over the internet to my TV</li><li>I want to hear the audio from either source through my headphones or my speakers</li></ul><p>These requirements are better expressed with a diagram:</p><figure><img alt="Sources and sinks of audio information across the system" class="dark-mode-hide" src="use_cases.png" width="400"><img alt="Sources and sinks of audio information across the system" class="dark-mode-show" src="use_cases_dark.png" width="400"><figcaption>The original design</figcaption></figure><p>Some other requirements also shaped what middle boxes I would need between the sources and sinks:</p><ul><li>Digital audio files need a DAC to convert to an analog signal</li><li>High impedance headphones need a dedicated amplifier</li><li>Having one input feed either output requires a switch</li></ul><p>The first two requirements make sense, but I didn’t want to buy four switches (one for each point a line splits or joins like the above diagram suggests). A little bit of redesigning yields the following design where both inputs share a DAC and both outputs share an amplifier:</p><figure><img alt="Sources and sinks of audio information across the system with two fewer switches" class="dark-mode-hide" src="design_rev1.png" width="400"><img alt="Sources and sinks of audio information across the system with two fewer switches" class="dark-mode-show" src="design_rev1_dark.png" width="400"><figcaption>The simplified design</figcaption></figure><p>That looks good. Now to find hardware that does roughly what this design prescribes.</p><h2 id="hardware">Hardware</h2><p>I settled on a mix of hardware I already owned and entry-level gear.</p><ul><li>JDS Labs Atom DAC+</li><li>JDS Labs Atom AMP+</li><li>Kanto YU4 Powered Stereo Speakers</li><li>Raspberry Pi 3B+</li></ul><p>Listing off hardware doesn’t do any good. Here’s how it looks when fully implemented:</p><figure><img alt="The fully detailed diagram of hardware and links between boxes" class="dark-mode-hide" src="design_rev2.png" width="800"><img alt="The fully detailed diagram of hardware and links between boxes" class="dark-mode-show" src="design_rev2_dark.png" width="800"><figcaption>The completed implementation</figcaption></figure><p>The keys that make this entire setup work are the DAC and Amplifier. The DAC has a front-mounted switch that allows me to toggle between the USB and Toslink inputs. The amplifier automatically switches to the 1/8’’ headphone out when one is plugged in, otherwise it routes to the speakers over RCA.</p><h2 id="software">Software</h2><p>In this state, the system will only play audio from the TV. To fix this, the Raspberry Pi needs to accept data over the network and convert it to USB for the DAC to process. I selected the following software to handle server-side transmission and client-side reception:</p><ul><li>Gerbera</li><li>Volumio</li></ul><p><a href="https://gerbera.io/" rel="noreferrer">Gerbera</a> is a Universal Plug-n-Play (UPnP) application running on my server that allows for streaming to local devices. <a href="https://volumio.com/en/get-started/" rel="noreferrer">Volumio</a> is a music player running on the Raspberry Pi with a web interface that streams data via Gerbera.</p><p>The entire flow of information is, again, best explained with a diagram:</p><figure><img alt="A UML sequence diagram showing the flow of network data to play a song" class="dark-mode-hide" src="song_data_flow.png" width="600"><img alt="A UML sequence diagram showing the flow of network data to play a song" class="dark-mode-show" src="song_data_flow_dark.png" width="600"><figcaption>Volumio handles the user interface and connection to the DAC</figcaption></figure><p>The keen eyed may have spotted a stray HDMI cable from the Raspberry Pi to the TV. When playing music, Volumio can be configured to show the album art, song title, and current track position on the display output. I decided to set that up, so now I can see what is playing without opening my laptop.</p><h2 id="how-does-it-sound">How Does it Sound?</h2><p>To my untrained ear? Phenomenal.</p><p>The best part is that there’s no weird hacky fixes, just plug in headphones, select a track, and enjoy.</p></main><div class="dark-mode-buttons"><button class="dark-mode-button dark-mode-hide" id="dark-mode-disable-button"><img alt="Dark mode" aria-label="dark mode toggle" title="Dark mode" height="24" src="https://www.mattnewcomer.org/dark_mode.svg" width="24"></button><button class="dark-mode-button dark-mode-show" id="dark-mode-enable-button"><img alt="Light mode" aria-label="light mode toggle" title="Light mode" height="24" src="https://www.mattnewcomer.org/light_mode.svg" width="24"></button></div><script>const cls=document.body.classList;const getSessionTheme=sessionStorage.getItem("theme");if(getSessionTheme==="dark"){cls.toggle("dark-mode",true)}else if(getSessionTheme==="light"){cls.toggle("dark-mode",false)}else if(window.matchMedia("(prefers-color-scheme: dark)").matches){cls.toggle("dark-mode",true)};document.getElementById("dark-mode-disable-button").addEventListener("click",function(a){cls.toggle("dark-mode",true);sessionStorage.setItem("theme","dark")});document.getElementById("dark-mode-enable-button").addEventListener("click",function(a){cls.toggle("dark-mode",false);sessionStorage.setItem("theme","light")})</script><noscript><style>.dark-mode-buttons{display:none}</style></noscript></body></html>